import{r,u as w,A as S,_ as y,F as f,j as n,a as g,S as C,I as p,B as v,b as x,c as E,d as I,E as T,m as R}from"./index-b4d424f9.js";const b=a=>{const t=r.useRef(!1),e=()=>{if(!t.current)return t.current=!0,typeof a=="function"?a():a};return r.useRef(e())},z=()=>{const[,a]=w(0);return r.useCallback(()=>a(t=>t+1),[])},h=(a,t,e,o,u)=>async(...s)=>{if(!(!t&&e[o])){e[o]=!0,u();try{const i=await a(...s);return e[o]=!1,u(),{success:!1,data:i}}catch(i){return console.error(i),e[o]=!1,u(),{success:!1,data:i}}}},F={num:1,loadingCall:!1},L=a=>{const{current:{num:t=1,loadingCall:e=!1}}=r.useRef(a||F),o=z();return b(()=>{const s={};for(let i=0;i<t;i++){const l=i===0?"":i+1,c="loading"+l;s[c]=!1,s["useLoadingCall"+l]=d=>h(d,e,s,c,o),s["useLoadingCallback"+l]=(d,m=[])=>r.useCallback(h(d,e,s,c,o),[h].concat(m)),s["useLoadingEffect"+l]=(d,m=[])=>r.useEffect(h(d,e,s,c,o),m)}return s}).current};var B={icon:function(t,e){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M81.8 537.8a60.3 60.3 0 010-51.5C176.6 286.5 319.8 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c-192.1 0-335.4-100.5-430.2-300.2z",fill:e}},{tag:"path",attrs:{d:"M512 258c-161.3 0-279.4 81.8-362.7 254C232.6 684.2 350.7 766 512 766c161.4 0 279.5-81.8 362.7-254C791.4 339.8 673.3 258 512 258zm-4 430c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z",fill:e}},{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258s279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766z",fill:t}},{tag:"path",attrs:{d:"M508 336c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z",fill:t}}]}},name:"eye",theme:"twotone"};const M=B;var O=function(t,e){return r.createElement(S,y({},t,{ref:e,icon:M}))};const k=r.forwardRef(O);var $={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};const A=$;var j=function(t,e){return r.createElement(S,y({},t,{ref:e,icon:A}))};const P=r.forwardRef(j),q=({value:a,onChange:t})=>{const[e,o]=r.useState("/api/user/captcha");f.Item.useStatus();const u=()=>{const s=Date.now();o(`/api/user/captcha?${s}`)};return n("div",{children:g(C,{direction:"vertical",align:"center",children:[g(C.Compact,{children:[n(p,{type:"text",placeholder:"驗證碼",value:a,onChange:t}),n(v,{onClick:u,children:n(P,{})})]}),n("img",{src:e,alt:"驗證碼",className:"mt-5"})]})})},_=()=>{const a=x(),t=E(),{loading:e,useLoadingCall:o}=L(),[u,s]=r.useState(!1);return r.useEffect(()=>{const l=localStorage.getItem("captcha");l!==null&&s(l)},[]),g(I,{children:[n("div",{className:"text-lg font-bold mb-4 text-center",children:"Shoperlink授權管理"}),g(f,{name:"login-form",onFinish:async l=>{const{data:c}=await t.login(l);(c==null?void 0:c.status)===!0?(R.success(c.message),a.push("/agents"),localStorage.removeItem("captcha")):(c==null?void 0:c.status)!==!0&&(c==null?void 0:c.captcha)===!0&&(s(!0),localStorage.setItem("captcha",u.toString()))},children:[n(f.Item,{name:"username",rules:[{required:!0,message:"請輸入使用者帳號"}],validateTrigger:["onChange","onBlur"],children:n(p,{placeholder:"使用者帳號"})}),n(f.Item,{name:"password",rules:[{required:!0,message:"請輸入使用者密碼"}],validateTrigger:["onChange","onBlur"],children:n(p.Password,{iconRender:l=>l?n(k,{}):n(T,{}),placeholder:"使用者密碼"})}),u&&n(f.Item,{name:"captcha",children:n(q,{})}),n("div",{className:"text-center",children:n(v,{type:"primary",htmlType:"submit",loading:e,children:"登入系統"})})]})]})};export{_ as default};
